
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Contributing to COMPASS &#8212; COMPASS 0.10.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=82662543"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.10.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">COMPASS 0.10.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    Home page
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../misc/installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../_autosummary/compass.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../_cli/cli.html">
    CLI reference
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../val/validation.html">
    Validation
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="index.html">
    Development
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    Home page
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../misc/installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../_autosummary/compass.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../_cli/cli.html">
    CLI reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../val/validation.html">
    Validation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="index.html">
    Development
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Contributing to COMPASS</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="contributing-to-compass">
<span id="contributing"></span><h1>Contributing to COMPASS<a class="headerlink" href="#contributing-to-compass" title="Link to this heading">#</a></h1>
<p>This document discusses working on the COMPASS code base and documentation.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>All code changes should be submitted via a pull request (PR) and
reviewed/approved by a core team member before merging  (see <a class="reference internal" href="#contributing-process">Contributing Process</a> below for more details).</p></li>
<li><p>Before setting up your environment, see the <a class="reference internal" href="#development-environment-guidelines">Development environment guidelines</a>.</p></li>
<li><p>All code should adhere to <a class="reference external" href="https://peps.python.org/pep-0008/">PEP8</a> (if you haven’t
read over it in a while, we recommend you skim it again for a refresher).</p></li>
<li><p>All code should adhere to the <a class="reference internal" href="#stylistic-guidelines">Stylistic guidelines</a>.</p></li>
<li><p>All code should have tests (see <a class="reference internal" href="#test-coverage">Test coverage</a> below for more details).</p></li>
<li><p>All code should be documented (see <a class="reference internal" href="#documentation">Documentation</a> below for more details).</p></li>
</ul>
</section>
<section id="contributing-process">
<h2>Contributing Process<a class="headerlink" href="#contributing-process" title="Link to this heading">#</a></h2>
<p>If you need a refresher on contributing code via GitHub using a pull request, check out the
<a class="reference external" href="https://docs.github.com/en/pull-requests">official GitHub documentation</a>. There, you can
learn how to <a class="reference external" href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-and-deleting-branches-within-your-repository">create a branch</a>,
<a class="reference external" href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request">open a pull request</a>,
and <a class="reference external" href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/requesting-a-pull-request-review">request a review</a>.</p>
<p>If you are not sure where or how to start contributing to COMPASS, consider reaching out to the
current developer(s): <strong>Paul Pinchuk</strong> [”<a class="reference external" href="mailto:ppinchuk&#37;&#52;&#48;nrel&#46;gov">ppinchuk<span>&#64;</span>nrel<span>&#46;</span>gov</a>”] or <strong>Guilherme Pimenta Castelao</strong> [”<a class="reference external" href="mailto:gpimenta&#37;&#52;&#48;nrel&#46;gov">gpimenta<span>&#64;</span>nrel<span>&#46;</span>gov</a>”].</p>
<p>When you are ready to contribute to COMPASS, clone a copy of the COMPASS repository from GitHub, check out your
own branch, and make the appropriate changes locally. Ensure that your new code adheres to all of the guidelines
below. When you are happy with your code, commit it locally. Ensure that you commit all tests that go along
with your code change.</p>
<p>Once all your code changes are committed locally and your code passes all tests, push it to the GitHub repository
and open a PR. Give your PR a short title and briefly describe your changes. Request that one of the core COMPASS
developers reviews your PR. We will likely ask you to make some modifications before you can merge. This is typical
and ensures that the quality of the overall codebase remains somewhat consistent.</p>
<p>Once your PR is approved, you may merge it into the main branch. If your code introduces significant new functionality
or fixes a critical bug, it may warrant a release. Please coordinate with a core COMPASS developer to create a new release,
which will automatically generate new wheels for installing COMPASS.</p>
<span class="target" id="dev-env-guidelines"></span></section>
<section id="development-environment-guidelines">
<h2>Development environment guidelines<a class="headerlink" href="#development-environment-guidelines" title="Link to this heading">#</a></h2>
<p>We use <a class="reference external" href="https://pixi.sh/latest/">pixi</a> to manage environments across developers.
This tool allows developers to install libraries and applications in a reproducible
way across multiple platforms. This means bugs are easier to reproduce, and it’s easier
to move your development environment to a new piece of hardware.</p>
<p>We keep a version-controlled <code class="docutils literal notranslate"><span class="pre">pixi.lock</span></code> in the repository to allow locking with
the full requirements tree so we can reproduce behaviors and bugs and easily compare
results.</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">pdev</span></code> feature in <code class="docutils literal notranslate"><span class="pre">pixi</span></code> to get all necessary python development tools:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pixi<span class="w"> </span>shell<span class="w"> </span>-e<span class="w"> </span>pdev
</pre></div>
</div>
<p>To work on the Rust-based CLI, you can use the <code class="docutils literal notranslate"><span class="pre">rdev</span></code> feature instead:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pixi<span class="w"> </span>shell<span class="w"> </span>-e<span class="w"> </span>rdev
</pre></div>
</div>
<p>You are welcome to use a different environment manager (e.g. <code class="docutils literal notranslate"><span class="pre">conda</span></code>, <code class="docutils literal notranslate"><span class="pre">mamba</span></code>, etc),
but we make no promises to provide support on environment-related issues/bugs in this case.</p>
</section>
<section id="stylistic-guidelines">
<h2>Stylistic guidelines<a class="headerlink" href="#stylistic-guidelines" title="Link to this heading">#</a></h2>
<p>We define a set of stylistic standards for COMPASS code development. The intent
is to maintain coherence when multiple developers contribute code to the repository.</p>
<section id="ruff">
<h3>Ruff<a class="headerlink" href="#ruff" title="Link to this heading">#</a></h3>
<p>Maintaining consistent code quality is crucial for COMPASS. To ensure uniformity and
adherence to coding standards, we employ the use <a class="reference external" href="https://docs.astral.sh/ruff/">Ruff</a>.
Ruff is an “opinionated” formatter and linter designed to enhance code readability,
maintainability, and consistency that is extremely fast.</p>
<p>You can use the <a class="reference external" href="https://marketplace.visualstudio.com/items?itemName=charliermarsh.ruff">Ruff VSCode extension</a>
if you are developing using VSCode. If you do so, make sure to set the path to the <code class="docutils literal notranslate"><span class="pre">ruff</span></code>
executable in your VSCode settings to point to the <code class="docutils literal notranslate"><span class="pre">ruff</span></code> installed in the <code class="docutils literal notranslate"><span class="pre">pdev</span></code> environment.
You can do this by adding the following to your <code class="docutils literal notranslate"><span class="pre">settings.json</span></code> file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;ruff.path&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;${workspaceFolder}/.pixi/envs/pdev/bin/ruff&quot;</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Alternatively, you can set a pre-commit hook to run Ruff. This would perform automatic code formatting
before any code is committed to the repository.</p>
<p>Both of these tools ensure that all code contributions meet the established quality standards,
minimizing the chances of introducing formatting inconsistencies or potential issues.</p>
</section>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h3>
<p>Use the following import conventions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">elm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</pre></div>
</div>
</section>
</section>
<section id="test-coverage">
<h2>Test coverage<a class="headerlink" href="#test-coverage" title="Link to this heading">#</a></h2>
<p>Pull requests (PRs) that modify code should either have new tests, or modify existing
tests to fail before the PR and pass afterwards.</p>
<p>You can run python COMPASS tests locally using <code class="docutils literal notranslate"><span class="pre">pixi</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pixi<span class="w"> </span>r<span class="w"> </span>-e<span class="w"> </span>ptest<span class="w"> </span>tests
</pre></div>
</div>
<p>Tests for a module should ideally cover all code in that module,
i.e., statement coverage should be at 100%, though this alone does not ensure that
your code is bug-free. Still, this is a good place to start, and you view the test
coverage at <code class="docutils literal notranslate"><span class="pre">build/coverage</span></code> by running:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>firefox<span class="w"> </span>build/coverage/index.html
</pre></div>
</div>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">#</a></h2>
<p>We strongly believe that documentation is a core part of code development, as it helps
both users of your function as well as other developers (including your future self).
As such, please adhere to these guidelines:</p>
<ol class="arabic">
<li><dl class="simple">
<dt>Document all public functions and classes</dt><dd><p>Public functions and classes are defined as not having any leading underscores (<code class="docutils literal notranslate"><span class="pre">_</span></code>).
These functions are detected by Sphinx and therefore should have docstrings formatted according to the
<a class="reference external" href="https://numpydoc.readthedocs.io/en/latest/format.html">NumPy documentation style</a>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Do not include a period (<code class="docutils literal notranslate"><span class="pre">.</span></code>) on the first line (short summary) of a docstring.</dt><dd><p>This is a stylistic decision particular to the COMPASS codebase.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Do not include a short summary (first line docstring) for <code class="docutils literal notranslate"><span class="pre">__init__</span></code> methods.</dt><dd><p>Instead, document any object summaries using the class docstring. You can and should still document
initialization parameters in the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> docstring. See any the docstring of the main COMPASS objects
(e.g. <a class="reference internal" href="../_autosummary/compass.services.openai.OpenAIService.html#compass.services.openai.OpenAIService" title="compass.services.openai.OpenAIService"><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenAIService</span></code></a>) for an example.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Protected/private functions should contain minimal documentation.</dt><dd><p>Public functions and classes are defined as having one or more leading underscores (<code class="docutils literal notranslate"><span class="pre">_</span></code>).
These functions are <strong>not</strong> detected by Sphinx and therefor should contain minimal documentation
(typically a docstring with just a single sentence). Do not include <em>any</em> sections from the
NumPy documentation style. With minimal exceptions,
we treat protected and private functions as implementation details. As such, if you did not
write the function, you should probably not be modifying/calling/touching it in any way.
Such code is subject to change at any time, so you should never rely on private/protected
functionality unless you know what you are doing (in which case you should be relying on the
function’s code, not docstring).</p>
</dd>
</dl>
</li>
<li><dl>
<dt>Link any functions and/or classes that you reference in your docstring.</dt><dd><p>Sphinx allows interlinks between different sets of documentation, which can be a really convenient
way for new users to learn more about the external libraries they are expected to use. For more
information on how to set up links in your documentation, please see
<a class="reference external" href="https://kevin.burke.dev/kevin/sphinx-interlinks/">this short blog post</a>. In particular,
we use the <code class="docutils literal notranslate"><span class="pre">:func:</span></code> directive for standalone functions, <code class="docutils literal notranslate"><span class="pre">:meth:</span></code> for class methods,
<code class="docutils literal notranslate"><span class="pre">:class:</span></code> for references to classes, and <code class="docutils literal notranslate"><span class="pre">:obj:</span></code> for all other links. Please use this
list of available COMPASS intersphinx mappings:</p>
<blockquote>
<div><ul>
<li><dl class="simple">
<dt>COMPASS: <code class="docutils literal notranslate"><span class="pre">compass</span></code></dt><dd><p>For example, use <code class="docutils literal notranslate"><span class="pre">:func:`~compass.scripts.process.process_jurisdictions_with_openai`</span></code>,
which renders as <a class="reference internal" href="../_autosummary/compass.scripts.process.process_jurisdictions_with_openai.html#compass.scripts.process.process_jurisdictions_with_openai" title="compass.scripts.process.process_jurisdictions_with_openai"><code class="xref py py-func docutils literal notranslate"><span class="pre">process_jurisdictions_with_openai()</span></code></a></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Pandas: <code class="docutils literal notranslate"><span class="pre">pandas</span></code></dt><dd><p>For example, use <code class="docutils literal notranslate"><span class="pre">:obj:`~numpy.array`</span></code>, which renders as <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="(in NumPy v2.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">array</span></code></a></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>MatplotLib: <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></dt><dd><p>For example, use <code class="docutils literal notranslate"><span class="pre">:func:`~matplotlib.pyplot.plot`</span></code>, which renders as <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html#matplotlib.pyplot.plot" title="(in Matplotlib v3.10.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">plot()</span></code></a></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Plotly: <code class="docutils literal notranslate"><span class="pre">plotly</span></code></dt><dd><p>For example, use <code class="docutils literal notranslate"><span class="pre">:class:`plotly.graph_objects.Figure`</span></code>, which renders as <a class="reference external" href="https://plotly.com/python-api-reference/generated/plotly.graph_objects.html#plotly.graph_objects.Figure" title="(in )"><code class="xref py py-class docutils literal notranslate"><span class="pre">plotly.graph_objects.Figure</span></code></a></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Networkx: <code class="docutils literal notranslate"><span class="pre">networkx</span></code></dt><dd><p>For example, use <code class="docutils literal notranslate"><span class="pre">:class:`~networkx.MultiDiGraph`</span></code>, which renders as <a class="reference external" href="https://networkx.org/documentation/stable/reference/classes/multidigraph.html#networkx.MultiDiGraph" title="(in NetworkX v3.5)"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiDiGraph</span></code></a></p>
</dd>
</dl>
</li>
<li><dl>
<dt>langchain_text_splitters<span class="classifier"><code class="docutils literal notranslate"><span class="pre">langchain_text_splitters</span></code></span></dt><dd><p>For example, use <code class="docutils literal notranslate"><span class="pre">:class:`~langchain_text_splitters.character.RecursiveCharacterTextSplitter`</span></code>,
which renders as <a class="reference external" href="https://python.langchain.com/api_reference/text_splitters/character/langchain_text_splitters.character.RecursiveCharacterTextSplitter.html#langchain_text_splitters.character.RecursiveCharacterTextSplitter" title="(in 🦜🔗 LangChain)"><code class="xref py py-class docutils literal notranslate"><span class="pre">RecursiveCharacterTextSplitter</span></code></a></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>elm: <code class="docutils literal notranslate"><span class="pre">elm</span></code></dt><dd><p>For example, use <code class="docutils literal notranslate"><span class="pre">:class:`elm.web.document.PDFDocument`</span></code>, which renders as <a class="reference external" href="https://nrel.github.io/elm/_autosummary/elm.web.document.PDFDocument.html#elm.web.document.PDFDocument" title="(in elm v0.0.31)"><code class="xref py py-class docutils literal notranslate"><span class="pre">elm.web.document.PDFDocument</span></code></a></p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
</ol>
<p>To check your docstring additions/updates, you can build a local version of the HTML documentation:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pixi<span class="w"> </span>r<span class="w"> </span>-e<span class="w"> </span>pdoc<span class="w"> </span>python-doc
</pre></div>
</div>
<p>After running this command, simply open <code class="docutils literal notranslate"><span class="pre">docs/_build/html/index.html</span></code> using your favorite browser, e.g.:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>firefox<span class="w"> </span>docs/_build/html/index.html
</pre></div>
</div>
</section>
<section id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Link to this heading">#</a></h2>
<p>A collection of other miscellaneous guidelines.</p>
<section id="github-actions-cache-and-updating-pyproject-toml">
<h3>GitHub Actions Cache and Updating <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code><a class="headerlink" href="#github-actions-cache-and-updating-pyproject-toml" title="Link to this heading">#</a></h3>
<p>Because we statically link the requirements, the Rust compilation process can
extend to 30-60 minutes. That is mostly due to the <code class="docutils literal notranslate"><span class="pre">duckdb</span></code> and <code class="docutils literal notranslate"><span class="pre">tokio</span></code>
crates. To optimize this process, we use a GitHub Actions cache.</p>
<p>When using the GitHub cache system, we have to be mindful of the 10 GB total
storage limit. If we place too many items in the cache, it will rotate too
frequently and defeat the entire purpose of the cache. For this reason,
<strong>we only cache environments that are run in actions on the main branch</strong>!</p>
<p>With this system, any PR can then pull from the cache built on the main branch
and set up their environments that way.</p>
<section id="what-this-means-for-you">
<h4>What this means for you<a class="headerlink" href="#what-this-means-for-you" title="Link to this heading">#</a></h4>
<p>When you open a PR, your environment will be built from a cache from the main branch.
If you have no dependency updates, you are good to go!</p>
<p>However, if you do have dependency updates, your environment will need to be updated.
If you are working with Rust, you will download and compile the extra crate(s) in your
branch. If the crate is small, this may not be a big deal, but keep in mind that this
will happen for every new commit you push to your open PR.</p>
<p>If you updated something in the <code class="docutils literal notranslate"><span class="pre">pixi</span></code> environment, the whole environment will be re-built.</p>
<p>Therefore, in both of the latter cases, a good practice is to put your dependency updates
in a separate branch and dedicated PR that you merge to main. Then, your feature PR
can make full use of the cache that is built on the main branch without having to re-build
or re-compile anything for the environment.</p>
</section>
</section>
<section id="error-handling">
<h3>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">#</a></h3>
<p>Do not throw default warning/errors. Always use some subclass of
<code class="docutils literal notranslate"><span class="pre">compass.warn.COMPASSWarning</span></code> or <code class="docutils literal notranslate"><span class="pre">compass.exceptions.COMPASSError</span></code>, like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">warnings</span><span class="w"> </span><span class="kn">import</span> <span class="n">warn</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">compass.warn</span><span class="w"> </span><span class="kn">import</span> <span class="n">COMPASSWarning</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">compass.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">COMPASSValueError</span>

<span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">my_func</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">not_good_enough_data</span><span class="p">:</span>
        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Watch out for your data!&quot;</span><span class="p">,</span> <span class="n">COMPASSWarning</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">unacceptable_value</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">COMPASSValueError</span><span class="p">(</span><span class="s2">&quot;This value is unacceptable&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This allows maximum flexibility for downstream users of the library.
In particular, they can choose whether to handle just errors that originate
from COMPASS (i.e. by catching <code class="docutils literal notranslate"><span class="pre">COMPASSValueError</span></code>) or to handle the generic
version of the error (i.e. by catching <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>).</p>
<p>In addition, all COMPASS warnings and errors have a logging call built in.
This means you no longer need to do something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># BAD - do not do this</span>
<span class="k">if</span> <span class="n">unacceptable_value</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;This value is unacceptable&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<p>Simply raising <code class="docutils literal notranslate"><span class="pre">COMPASSValueError</span></code> with the appropriate message performs the
logging call shown above, internally, every time.</p>
</section>
<section id="test-file-structure">
<h3>Test File Structure<a class="headerlink" href="#test-file-structure" title="Link to this heading">#</a></h3>
<p>All test files (e.g. <code class="docutils literal notranslate"><span class="pre">test_scenario.py</span></code>) should start/end with the following block of code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="o">...</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">pytest</span><span class="o">.</span><span class="n">main</span><span class="p">([</span><span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;--show-capture=all&quot;</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;-rapP&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>This allows the (single) file to be executed, running only the tests contained
within. This is extremely useful when updating/modifying/adding tests in the file.</p>
</section>
<section id="docker-container">
<h3>Docker Container<a class="headerlink" href="#docker-container" title="Link to this heading">#</a></h3>
<p>When updating the Dockerfile, ensure that your changes can be built on both AMD and ARM
linux. To do so, test building a multi-platform image with this command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>linux/amd64,linux/arm64<span class="w"> </span>-t<span class="w"> </span>compass:latest<span class="w"> </span>.
</pre></div>
</div>
<p>You can then get a shell in your container using the following command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--platform<span class="w"> </span>linux/amd64<span class="w"> </span>-v<span class="w"> </span>my_output_volume:/app/outputs<span class="w"> </span>compass:latest<span class="w"> </span>/bin/bash
</pre></div>
</div>
<p>Once you have a shell, you can verify that the container works as expected using the following steps:</p>
<ol class="arabic simple">
<li><p>Run <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">crawl4ai-doctor</span></code> and ensure that the crawl tests pass</p></li>
<li><p>Open up a python instance (<code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">python</span></code>) and set up the following script:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">elm.web.search.run</span><span class="w"> </span><span class="kn">import</span> <span class="n">web_search_links_as_docs</span>

<span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Decatur Indiana wind energy conversion system zoning ordinance&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>You can then test playwright by running the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">docs</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">web_search_links_as_docs</span><span class="p">(</span>
        <span class="n">q</span><span class="p">,</span>
        <span class="n">search_engines</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PlaywrightDuckDuckGoLinkSearch&quot;</span><span class="p">],</span>
        <span class="n">pw_launch_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;--no-sandbox&quot;</span><span class="p">]}</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If you don’t get any critical errors (poppler errors are ok) and you see some output in the <code class="docutils literal notranslate"><span class="pre">docs</span></code>
variable, then you are good to go. Similarly, you can test the camoufox browser using the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">docs</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">web_search_links_as_docs</span><span class="p">(</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">search_engines</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PlaywrightGoogleLinkSearch&quot;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Again, if you don’t get any critical errors (poppler errors are ok) and you see some output in the <code class="docutils literal notranslate"><span class="pre">docs</span></code>
variable, then you are good to go.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contributing-process">Contributing Process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#development-environment-guidelines">Development environment guidelines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stylistic-guidelines">Stylistic guidelines</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ruff">Ruff</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-coverage">Test coverage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#documentation">Documentation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellaneous">Miscellaneous</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#github-actions-cache-and-updating-pyproject-toml">GitHub Actions Cache and Updating <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#what-this-means-for-you">What this means for you</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling">Error Handling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#test-file-structure">Test File Structure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-container">Docker Container</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Alliance for Sustainable Energy, LLC.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>